DROP TABLE IF EXISTS FILM_LIKES CASCADE;
DROP TABLE IF EXISTS USER_FRIEND CASCADE;
DROP TABLE IF EXISTS FILM_GENRES CASCADE;
DROP TABLE IF EXISTS GENRES CASCADE;
DROP TABLE IF EXISTS MPA CASCADE;
DROP TABLE IF EXISTS USERS CASCADE;
DROP TABLE IF EXISTS FILMS CASCADE;
DROP TABLE IF EXISTS DIRECTORS CASCADE;
DROP TABLE IF EXISTS FILM_DIRECTORS CASCADE;

CREATE TABLE GENRES (
	GENRE_ID INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	NAME CHARACTER VARYING(200) NOT NULL
);
CREATE TABLE MPA (
	MPA_ID INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	NAME CHARACTER VARYING(200) NOT NULL,
	DESCRIPTION CHARACTER VARYING(200) NOT NULL
);
CREATE TABLE FILMS (
	FILM_ID INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	NAME CHARACTER VARYING(200) NOT NULL,
	DESCRIPTION CHARACTER VARYING(200) NOT NULL,
	RELEASE_DATE DATE NOT NULL,
	DURATION INTEGER NOT NULL,
	MPA_ID INTEGER NOT NULL REFERENCES MPA(MPA_ID) ON DELETE CASCADE
);
CREATE TABLE FILM_GENRES (
    PAIR_ID INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	FILM_ID INTEGER NOT NULL REFERENCES FILMS(FILM_ID) ON DELETE CASCADE,
	GENRE_ID INTEGER NOT NULL REFERENCES GENRES(GENRE_ID) ON DELETE CASCADE
);
CREATE UNIQUE index IF NOT EXISTS FILM_GENRE_UINDEX on FILM_GENRES (FILM_ID, GENRE_ID);

CREATE TABLE USERS (
	USER_ID INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	EMAIL CHARACTER VARYING(200) NOT NULL,
	LOGIN CHARACTER VARYING(200) NOT NULL,
	NAME CHARACTER VARYING(200) NOT NULL,
	BIRTHDAY DATE NOT NULL
);
CREATE UNIQUE index IF NOT EXISTS USER_EMAIL_UINDEX on USERS (email);
CREATE UNIQUE index IF NOT EXISTS USER_LOGIN_UINDEX on USERS (login);

CREATE TABLE FILM_LIKES (
    PAIR_ID INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	FILM_ID INTEGER NOT NULL REFERENCES FILMS(FILM_ID) ON DELETE CASCADE,
	USER_ID INTEGER NOT NULL REFERENCES USERS(USER_ID) ON DELETE CASCADE
);
CREATE UNIQUE index IF NOT EXISTS FILM_LIKE_UINDEX on FILM_LIKES (FILM_ID, USER_ID);

CREATE TABLE USER_FRIEND (
    PAIR_ID INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	USER_ID INTEGER NOT NULL REFERENCES USERS(USER_ID) ON DELETE CASCADE,
	FRIEND_ID INTEGER NOT NULL REFERENCES USERS(USER_ID) ON DELETE CASCADE
);
CREATE UNIQUE index IF NOT EXISTS USER_FRIEND_UINDEX on USER_FRIEND (USER_ID, FRIEND_ID);

CREATE TABLE DIRECTORS (
    DIRECTOR_ID INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NAME CHARACTER VARYING(200) NOT NULL
);

CREATE TABLE FILM_DIRECTORS (
    PAIR_ID INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    FILM_ID INTEGER NOT NULL REFERENCES FILMS(FILM_ID) ON DELETE CASCADE,
    DIRECTOR_ID INTEGER NOT NULL REFERENCES DIRECTORS(DIRECTOR_ID) ON DELETE CASCADE
);
CREATE UNIQUE index IF NOT EXISTS FILM_DIRECTOR_UINDEX on FILM_DIRECTORS (FILM_ID, DIRECTOR_ID);